# 세션 DB를 통한 인증

## 세션

- 세션의 협의: `현재 로그인된 사용자들에 대한 정보`. 특정 사용자가 해당 브라우저, 폰에서 언제까지 로그인 상태를 유지해도 되는지에 대한 정보, 동일한 사용자 계정이 어떤 브라우저, 폰들에서 동시에 로그인하고 있는 중인지에 대한 정보.
- 세션의 광의: 일정 시간동안 같은 사용자로부터 들어오는 일련의 요구를 하나의 상태로 보고 그 상태를 일정하게 유지시키는 기술.
- 필요한 이유: HTTP는 stateless protocol이기 때문에 각 요청은 서로 독립적. 서버는 이전 요청에 대한 정보 알 수 없음.

### 인증 시스템 구현 : 세션 DB 관리

1. 사용자가 ID+비번으로 로그인 성공시, 서버는 세션DB에 해당 유저의 데이터를 한 줄 생성.
2. 생성된 세션의 세션ID는 브라우저에 쿠키로 저장됨.
3. 로그인된 사용자가 다른 요청을 보낼 때 쿠키로부터 세션ID 값을 읽어내고 해당 값을 Authorazation 헤더에 담아서 서버에 보냄.
4. 서버는 Authorazation 헤더 값에서 세션ID의 존재여부를 체크
5. 세션DB에서 세션ID 값에 해당되는 데이터를 조회 => 요청을 보낸 사용자가 누군지 체크 => 사용자 정보에 따라 관련 서비스 호출하고 요청 처리 후 응답
6. 세션ID가 없거나, 세션의 유효기간이 이미 만료되었으면 Exception 발생하고, 사용자를 로그인하는 화면으로 redirect하도록 브라우저에 응답

### 특징

- 브라우저: 세션ID 값만 쿠키 형식으로 관리.
- 서버에서 모든 사용자 정보를 관리.
- 세션DB의 세션ID를 그대로 브라우저로 전달해도 됨. 세션에 사용자 정보가 부분적으로 담겨있을 뿐. 세션만으로는 알 수 없음.
- 주로 Redis 등을 통해 세션DB 관리.

### 장점 : 다양한 로그인 계정 관리 기능 구현 가능

- 세션DB에서 특정 세션을 삭제하는 방식으로 강제 로그아웃 구현 가능
- 동일한 계정을 복수의 사용자가 공유하는 문제 예방 가능.
- 넷플릭스: 동일한 계정을 함께 공유할 수 있는 기기들의 개수 관리 가능. 현재 로그인한 사용자 수 확인 가능.
- 인스타그램: 사용자가 직접 이전에 로그인했던 다른 기기들에서 로그아웃되도록 구현 가능

### 단점 : DB 유지 필요

- 요청이 있을 때마다 매번 DB를 조회해야 함.
- 사용자가 늘어날수록 DB 자원 증가하고 성능 저하되는 문제점.
